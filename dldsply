#!/bin/bash
#
DESC="Enable|disable extended desktop using XRandR"

set -eu

PROG="dldsply"
FOO=${1:-}  # Script requires an option to be specified.
LAYOUT="--off"

run_options() {
# If required, verify at least one option has been specified.
if [[ -z $FOO ]]; then
    printf 'ERROR: No option specified.\n'
    exit 1
fi
#
while getopts ":hlrq" OPT
do
    case $OPT in
        h)
            printf 'DESCRIPTION\n'
            printf '\t%s\n' "$PROG - ${DESC}"
            printf 'USAGE\n'
            printf '\tdldsply [OPTION]\n'
            printf 'OPTIONS\n'
            printf '\t-h\n'
            printf '\t\tthis help message\n'
            printf '\t-l\n'
            printf '\t\tdisplay layout is LEFT->RIGHT\n'
            printf '\t-r\n'
            printf '\t\tdisplay layout is RIGHT->LEFT\n'
            printf '\t-q\n'
            printf '\t\tdisable extended desktop\n'
            printf 'EXAMPLE\n'
            printf '\tA large display on the LEFT connected to a laptop on \n'
            printf '\tthe RIGHT. The external display is the primary desktop,\n'
            printf '\tand when the cursor moves past the right edge of the \n'
            printf '\tprimary screen it emerges from the left edge of the \n'
            printf '\t(secondary) laptop screen ...\n'
            printf '\t\t%s\n' "$ ${PROG} -l"
            exit 0
            ;;
        l)
            LAYOUT="--left-of"
            ;;
        r)
            LAYOUT="--right-of"
            ;;
        q)
            LAYOUT="--off"
            ;;
        *)
            printf '%s\n' "'-${OPTARG}' is an invalid option."
            exit 1
            ;;
    esac
done
}

conf_desktop() {
local DISPLAY1
    DISPLAY1=$(xrandr | grep " connected" | awk 'FNR == 1 {print $1}')
local DISPLAY2
    DISPLAY2=$(xrandr | grep " connected" | awk 'FNR == 2 {print $1}')
local DESKTOP="--output $DISPLAY1 --auto --output $DISPLAY2 --primary"
if [[ -n $DISPLAY2 ]]; then
    if [[ $LAYOUT == "--off" ]]; then
        xrandr $DESKTOP $LAYOUT
    else
        xrandr $DESKTOP --auto $LAYOUT $DISPLAY1
    fi
fi
}

run_options "$@"
conf_desktop
